<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/socket.js"></script>
</head>
<body>
    <h1 id="room"></h1>
    <ul id="users"></ul>
    <ul id="messages"></ul>
    <form name="chat">
        <input type="text" name="message">
    </form>

    <div id="player"></div>
    <button id="play_pause_button">再生</button>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="/player.js"></script>
    <script>
        var player;
        var socket;

        document.getElementById('room').innerText = getRoomName();

        function onPlayerReady(event) {
            player = new Player(event.target);            
            socket = new Socket();
    
            document.getElementById('play_pause_button').addEventListener('click', function() {
                if (player.isPlaying()) {
                    player.pause();
                    socket.sendPause();
                } else {
                    player.play();
                    socket.sendPlay();
                }
            }, false);
    
            document.forms['chat'].onsubmit = function() {
                socket.sendMessage(
                    document.forms['chat'].elements['message'].value
                );
                return false;
            };
        }

        function onChangeOthersPlayerState(event) {
            switch (event.type) {
                case 'play':
                    player.play();
                    break;
                case 'pause':
                    player.pause();
                    break;
            }
        }
        
        function onPlay() {
            document.getElementById('play_pause_button').innerText = '停止';
        }
    
        function onPause() {
            document.getElementById('play_pause_button').innerText = '再生';
        }
    
        function onPlayWithTouchingFrame() {
            socket.sendPlay();
        }
    
        function onPauseWithTouchingFrame() {
            socket.sendPause();
        }

        function getRoomName() {
            return location.href.split('/').pop();
        }

        function addMessage(msg) {
            var ul = document.getElementById('messages');
            addList(ul, msg);
        }

        function updateUsers(users) {
            var ul = document.getElementById('users');
            while(ul.firstChild) { ul.removeChild(ul.firstChild); }
            users.forEach((user)=>{
                addList(ul, user);
            });
        }

        function addList(ul, text) {
            var li = document.createElement('li');
            li.appendChild(document.createTextNode(text));
            ul.appendChild(li);
            return li;
        }
    </script>
</body>
</html>